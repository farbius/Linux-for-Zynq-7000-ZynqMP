From da3f768c7fe3d5a690d9e0a0446965d2e4082f65 Mon Sep 17 00:00:00 2001
From: Aleksei Rostov <farbius@protonmail.com>
Date: Sat, 29 Jul 2023 06:02:39 -0700
Subject: [PATCH] trenz-config

---
 arch/arm/dts/Makefile          |  3 ++-
 arch/arm/dts/zynqmp-trenz.dts  | 31 +++++++++++++++++++++++++++++++
 include/configs/zynqmp-trenz.h | 27 +++++++++++++++++++++++++++
 3 files changed, 60 insertions(+), 1 deletion(-)
 create mode 100644 arch/arm/dts/zynqmp-trenz.dts
 create mode 100644 include/configs/zynqmp-trenz.h

diff --git a/arch/arm/dts/Makefile b/arch/arm/dts/Makefile
index 51f2376000..da764ac24b 100644
--- a/arch/arm/dts/Makefile
+++ b/arch/arm/dts/Makefile
@@ -389,7 +389,8 @@ dtb-$(CONFIG_ARCH_ZYNQMP) += \
 	zynqmp-zc1751-xm016-dc2.dtb		\
 	zynqmp-zc1751-xm017-dc3.dtb		\
 	zynqmp-zc1751-xm018-dc4.dtb		\
-	zynqmp-zc1751-xm019-dc5.dtb
+	zynqmp-zc1751-xm019-dc5.dtb		\
+	zynqmp-trenz.dtb
 dtb-$(CONFIG_ARCH_VERSAL) += \
 	versal-mini.dtb \
 	versal-mini-emmc0.dtb \
diff --git a/arch/arm/dts/zynqmp-trenz.dts b/arch/arm/dts/zynqmp-trenz.dts
new file mode 100644
index 0000000000..f44ffd6527
--- /dev/null
+++ b/arch/arm/dts/zynqmp-trenz.dts
@@ -0,0 +1,31 @@
+/*
+ * CAUTION: This file is automatically generated by Xilinx.
+ * Version: XSCT 2022.2
+ * Today is: Thu Jun  8 12:07:21 2023
+ */
+
+
+/dts-v1/;
+#include "zynqmp.dtsi"
+#include "zynqmp-clk-ccf.dtsi"
+#include "pcw.dtsi"
+/ {
+	chosen {
+		bootargs = "earlycon console=ttyPS0,115200 clk_ignore_unused";
+		stdout-path = "serial0:115200n8";
+	};
+	aliases {
+		ethernet0 = &gem3;
+		i2c0 = &i2c0;
+		serial0 = &uart0;
+		spi0 = &qspi;
+	};
+	memory {
+		device_type = "memory";
+		reg = <0x0 0x0 0x0 0x7ff00000>;
+	};
+	cpus {
+		/delete-node/ cpu@2 ;
+		/delete-node/ cpu@3 ;
+	};
+};
diff --git a/include/configs/zynqmp-trenz.h b/include/configs/zynqmp-trenz.h
new file mode 100644
index 0000000000..0210f7448e
--- /dev/null
+++ b/include/configs/zynqmp-trenz.h
@@ -0,0 +1,27 @@
+#include <configs/xilinx_zynqmp.h>
+
+/* ethernet - psu_ethernet_3 */
+#define CONFIG_SYS_FAULT_ECHO_LINK_DOWN
+#define PHY_ANEG_TIMEOUT 20000
+#define CONFIG_MII
+#define CONFIG_NET_MULTI
+#define CONFIG_NETCONSOLE	1
+
+
+#define CONFIG_GATEWAYIP	192.168.0.1
+#define CONFIG_NETMASK		255.255.255.0
+#define CONFIG_SERVERIP 	192.168.0.21 
+
+#define CONFIG_SYS_PROMPT "trenz-boot> "
+
+#define CONFIG_EXTRA_ENV_SETTINGS 	\
+	"ipaddr=192.168.0.123\0" 	\
+	"qspiboot=echo Copying Linux from QSPI to RAM...;" 	\
+		"sf probe 0 && sf read 0x60000000 0x800000 0x800000 && bootm 0x60000000\0" 			\
+	"sdboot=echo Copying Linux from miroSD to RAM...;" 	\
+		"fatload mmc 1 0x60000000 image.itb && bootm 0x60000000\0" 			\
+	"tftpboot=echo Copying Linux via TFTP to RAM...;"	\
+		"tftpb 0x60000000 image.itb && bootm 0x60000000\0"	\
+""
+
+#define CONFIG_BOOTCOMMAND	"run sdboot"
-- 
2.17.1

